package TestCommands;
import SystemCommands.*;
import java.io.File;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import static org.junit.Assert.*;
import org.junit.After;
import org.junit.AfterClass;
import org.junit.Before;
import org.junit.BeforeClass;
import org.junit.Test;

class MvTest {

    private mv mvCommand;

    @Before
    void setUp() {
        mvCommand = new mv();
    }

    @After
    void tearDown() {
        // Clean up any test files created
        if (mvCommand.multiplePaths != null) {
            for (String path : mvCommand.multiplePaths) {
                File file = new File(path);
                if (file.exists()) {
                    file.delete();
                }
            }
        }
    }

    @Test
    void testMoveFileToExistingDirectory() {
        try {
            // Create source and destination directories
            Path sourcePath = Paths.get("sourceFile.txt");
            Path destinationDir = Paths.get("testDir");
            Files.createFile(sourcePath);
            Files.createDirectory(destinationDir);

            // Set paths for mv command
            mvCommand.multiplePaths = new String[]{"sourceFile.txt", "testDir"};
            String result = mvCommand.execute();

            // Verify results
            assertEquals("File Moved Successfully", result);
            assertTrue(Files.exists(destinationDir.resolve("sourceFile.txt")), "File should be moved to the destination directory");

        } catch (Exception e) {
            fail("Exception occurred during test execution: " + e.getMessage());
        }
    }

    @Test
    void testMoveNonExistentFile() {
        mvCommand.multiplePaths = new String[]{"nonExistentFile.txt", "testDir"};

        // Expecting error message since source file doesn't exist
        String result = mvCommand.execute();
        assertTrue(result.contains("NoSuchFileException"), "Expected NoSuchFileException in result");
    }

    @Test
    void testMoveWithNoPaths() {
        mvCommand.multiplePaths = new String[]{};

        // Expecting message for missing source and destination
        String result = mvCommand.execute();
        assertEquals("No Source and Destination Paths Entererd", result);
    }

    @Test
    void testMoveFileToSamePath() {
        try {
            // Create a test file
            Path sourcePath = Paths.get("testFile.txt");
            Files.createFile(sourcePath);

            // Set paths with same source and destination
            mvCommand.multiplePaths = new String[]{"testFile.txt", "testFile.txt"};
            String result = mvCommand.execute();

            // Expecting message that file already exists
            assertEquals("File Already Exists", result);

        } catch (Exception e) {
            fail("Exception occurred during test execution: " + e.getMessage());
        }
    }

    @Test
    void testInvalidDestinationPath() {
        try {
            // Create a source file
            Path sourcePath = Paths.get("testFile.txt");
            Files.createFile(sourcePath);

            // Set paths with invalid destination
            mvCommand.multiplePaths = new String[]{"testFile.txt", "nonExistentDir"};
            String result = mvCommand.execute();

            // Expecting error message for invalid destination
            assertEquals("Destination Path doesn't exist", result);

        } catch (Exception e) {
            fail("Exception occurred during test execution: " + e.getMessage());
        }
    }
}
